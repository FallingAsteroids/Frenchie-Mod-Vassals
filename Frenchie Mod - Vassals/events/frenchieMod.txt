namespace = frenchie_mod

country_event = { #event for getting money as an estate from other provinces
  id = frenchie_mod.1
  title = "frenchie_mod_1.t"
  desc = "frenchie_mod_1.d"
  picture = "DIPLOMACY_eventPicture"
  hidden = yes

  trigger = {
    AND = {
      is_subject_of_type = estate
      has_country_flag = estate
      NOT = {
        has_country_flag = collected_estate_tax
      }
      NOT = {
        is_month = 1
      }
    }
  }
  immediate = {
    ROOT = {
      set_country_flag = collected_estate_tax
      multiply_variable = {
        which = frenchie_estate_added_tax_income
        value = 0
      }
      overlord = {
        every_subject_country = {
          limit = {
            NOT = {
              is_subject_of_type = protectorate
            }
          }
          every_owned_province = {
            if = {
              limit = {
                AND = {
                  OR = {
                    culture = ROOT
                    is_core = ROOT
                    any_neighbor_province = {
                      is_capital_of = ROOT
                    }
                    previous_owner = ROOT
                  }
                  NOT = {
                    controlled_by = ROOT
                  }
                }
              }
              log = "===== OVERLORD SUBJECT PROVINCES ROOT IS [Root.GetName]"
              log = "===== Found provice, it is [This.GetName]"
              export_to_variable = {
                which = additionnal_income
                value = base_tax
              }
              log = "===== Its base tax is [This.additionnal_income.GetValue]"
              export_to_variable = {
                which = fprovince_local_autonomy
                value = local_autonomy
              }
              log = "===== Its autonomy is [This.fprovince_local_autonomy.GetValue]"
              multiply_variable = {
                which = additionnal_income
                which = fprovince_local_autonomy
              }
              divide_variable = {
                which = additionnal_income
                value = 100
              }
              log = "===== The Adjusted income from the province is [This.additionnal_income.GetValue]"
              ROOT = {
                set_variable = {
                  which = additionnal_income
                  which = PREV
                }
                log = "===== The Adjusted income extracted to root is [Root.additionnal_income.GetValue]"
                change_variable = {
                  which = frenchie_estate_added_tax_income
                  which = additionnal_income
                }
                log = "===== frenchie_estate_added_tax_income is now [Root.frenchie_estate_added_tax_income.GetValue]"
              }
            }
          }
        }
        every_owned_province = {
          if = {
            limit = {
              AND = {
                OR = {
                  culture = ROOT
                  is_core = ROOT
                  any_neighbor_province = {
                    is_capital_of = ROOT
                  }
                  previous_owner = ROOT
                }
                NOT = {
                  controlled_by = ROOT
                }
              }
            }
            log = "===== OVERLORD PROVINCES ROOT IS [Root.GetName]"
            log = "===== Found provice, it is [This.GetName]"
            export_to_variable = {
              which = additionnal_income
              value = base_tax
            }
            log = "===== Its base tax is [This.additionnal_income.GetValue]"
            export_to_variable = {
              which = fprovince_local_autonomy
              value = local_autonomy
            }
            log = "===== Its autonomy is [This.fprovince_local_autonomy.GetValue]"
            multiply_variable = {
              which = additionnal_income
              which = fprovince_local_autonomy
            }
            divide_variable = {
              which = additionnal_income
              value = 100
            }
            log = "===== The Adjusted income from the province is [This.additionnal_income.GetValue]"
            ROOT = {
              set_variable = {
                which = additionnal_income
                which = PREV
              }
              log = "===== The Adjusted income extracted to root is [Root.additionnal_income.GetValue]"
              change_variable = {
                which = frenchie_estate_added_tax_income
                which = additionnal_income
              }
              log = "===== frenchie_estate_added_tax_income is now [Root.frenchie_estate_added_tax_income.GetValue]"
            }
          }
        }
      }
      set_variable = {
        which = frenchie_used_estate_added_tax_income
        value = 0
      }
      log = "===== frenchie_estate_added_tax_income: [Root.frenchie_estate_added_tax_income.GetValue]"
      log = "===== frenchie_used_estate_added_tax_income: [Root.frenchie_used_estate_added_tax_income.GetValue]"
      multiply_variable = {
        which = frenchie_estate_added_tax_income
        value = 1.5
      }
      while = {
        limit = {
          check_variable = {
            which = frenchie_estate_added_tax_income
            which = frenchie_used_estate_added_tax_income
          }
        }
        change_variable = {
          which = frenchie_used_estate_added_tax_income
          value = 1
        }
        add_treasury = 1
        log = "===== frenchie_estate_added_tax_income: [Root.frenchie_estate_added_tax_income.GetValue]"
        log = "===== frenchie_used_estate_added_tax_income: [Root.frenchie_used_estate_added_tax_income.GetValue]"
      }
    }
  }

  option = {
    name = "frenchie_mod_1.a"
  }
}

country_event = { #event for getting money as an estate from other provinces
  id = frenchie_mod.2
  title = "frenchie_mod_2.t"
  desc = "frenchie_mod_2.d"
  picture = "DIPLOMACY_eventPicture"
  hidden = yes

  trigger = {
    AND = {
      is_subject_of_type = estate
      has_country_flag = estate
      NOT = {
        is_month = 3
      }
      has_country_flag = collected_estate_tax
    }
  }
  immediate = {
    clr_country_flag = collected_estate_tax
  }
  option = {
    name = "frenchie_mod_1.a"
  }
}

country_event = { #autorelease conquered countries as estates
  id = frenchie_mod.3
  title = "frenchie_mod_3.t"
  desc = "frenchie_mod_3.d"
  picture = "DIPLOMACY_eventPicture"
  hidden = yes

  is_triggered_only = yes

  immediate = {
    log = "FRENCHIE MOD 3 HAS HAPPENED"
    country_event = {
      id = frenchie_mod.4
      days = 1
    }
  }
  option = {
    name = "frenchie_mod_3.a"
  }
}

country_event = { #autorelease conquered countries as estates
  id = frenchie_mod.4
  title = "frenchie_mod_4.t"
  desc = "frenchie_mod_4.d"
  picture = "DIPLOMACY_eventPicture"
  hidden = yes

  is_triggered_only = yes

  immediate = {
    if {
      limit = {
        any_known_country = {
          has_country_flag = estatetoannex@ROOT
        }
      }
      log = "FRENCHIE MOD 4 HAS HAPPENED"
      ROOT = {
        create_subject = {
          subject_type = color
          subject = PREV
        }
        create_subject = {
          subject_type = estate
          subject = PREV
        }
        clr_country_flag = estatetoannex@ROOT
      }
    }
  }
  option = {
    name = "frenchie_mod_4.a"
  }
}
